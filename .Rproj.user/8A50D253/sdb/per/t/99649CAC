{
    "contents" : "cat(\"\\014\")\n#These first few lines run only when the file is run in RStudio, !!NOT when an Rmd/Rnw file calls it!!\nrm(list=ls(all=TRUE))  #Clear the variables from previous runs.\n\n############################\n## @knitr LoadPackages\nrequire(RODBC)\nrequire(grid)\nrequire(lattice)\nrequire(dplyr)\nrequire(ggplot2)\nrequire(gridExtra)\nrequire(lme4)\nrequire(reshape2)\n\n############################\n## @knitr DeclareGlobals\n# load common aesthetics definitions used in the reports\nsource(\"./Models/Descriptives/AesDefine.R\")\n# read back the definitions\n# aesDefs\n\n############################\n## @knitr LoadData\ndsL<-readRDS(\"./Data/Derived/dsL.rds\")\nsource(\"./Models/LCM/LCModels.R\")\n\n\n\n\n############################\n## @knitr defineData\nnumID<- 9022 # highest id value (max = 9022)\n### Define the data that will populate the model\nds<- dsL %>%  # chose conditions to apply in creating dataset for modeling\n  dplyr::filter(id < numID) %.% # 1:9022\n  dplyr::filter(year %in% c(2000:2011)) %.% # 1997:2011\n  dplyr::filter(sample %in% c(1)) %.% # 0-Oversample; 1-Cross-Sectional\n  dplyr::filter(race %in% c(4)) %.% # 1-Black; 2-Hispanis; 3-Mixed; 4-White\n  dplyr::filter(byear %in% c(1980:1984)) %.% # birth year 1980:1984\n  dplyr::filter(ave(!is.na(attend), id, FUN = all)) %.% # only complete trajectories\n  dplyr::mutate( # compute new variables\n    age= year-byear, # definition of age to be used in the model    \n    timec=year-2000, # metric of time is rounds of NSLY97 in years, centered at 2000\n    timec2= timec^2, \n    timec3= timec^3,\n    #         timec= age-16, # metric of time is bilogical age in years, centered at 16\n    #         timec2= timec^2,\n    #         timec3= timec^3,# \n    cohort=byear-1980) %.% # age difference, years younger (unit - 1 cohort away)\n  dplyr::select( # assemble the dataset for modeling\n    id, sample, race, byear,cohort, # Time Invariant variables\n    year,\n    age, timec,timec2,timec3, attend)  # Time Variant variables\nhead(ds)\ntable(ds$byear) # the year of birth  - metric: YEAR \ntable(ds$age) # years past 16 -  metric: AGE\ntable(ds$year, ds$age) # YEAR by  AGE \nlength(unique(ds$id)) # total No. of respondents in dataset\nsum(!is.na(ds$attend)) # valid datapoints \nsum(is.na(ds$attend)) # NA in the dataset \nlength(unique(ds$timec))\n\n## FOR TESTING ###\n# flmer<- as.formula(call_m5R1)\n# model <-lmer (flmer, data = ds, REML=FALSE,\n#               control=lmerControl(optCtrl=list(maxfun=20000)))\n# modelR<-model\n# \n# fnlme<- as.formula(call_m5F)\n# model<- nlme::gls(f, data=ds,method = \"ML\")\n# modelF<-model\n\n###################\n\n# # Traditional reading in the files\n# getModels<- c(\"m7R3\")\n# getAll<- modelList\n# \n# \n# for(i in allModels){\n#   modelName<- i\n#   pathdsmInfo <- file.path(\"./Models/LCM/models/datasets\",paste0(i,\"_mInfo.rds\"))\n#   pathdsFERE  <- file.path(\"./Models/LCM/models/datasets\",paste0(i,\"_FERE.rds\"))\n#   pathdsp  <- file.path(\"./Models/LCM/models/datasets\",paste0(i,\"_dsp.rds\"))\n#   mInfoTemp<- readRDS(pathdsmInfo)\n#   FERETemp<- readRDS(pathdsFERE)\n#   dspTemp<- readRDS(pathdsp)\n#   \n#   assign(paste0(i,\"_mInfo\"),mInfoTemp)\n#   assign(paste0(i,\"_FERE\"),FERETemp)\n#   assign(paste0(i,\"_dsp\"),dspTemp)\n#   rm(list = c(\"mInfoTemp\", \"FERETemp\", \"dspTemp\"))\n# }\n\n###################\n# Read in different REDS files and join them all together\npathDataDirectory <- file.path(\"./Models/LCM/models/datasets\")\n# filenamePattern <- \".+\\\\.rds\" #All RDS files\nfilenamePattern <- \"m.{1,}Info\\\\.rds\" #All RDS files\n\nretrievedFilenames <- list.files(path=pathDataDirectory, pattern=filenamePattern)\nfilePaths <- file.path(pathDataDirectory, retrievedFilenames)\n\ndsInfo <- readRDS(filePaths[1])\nfor( i in 1:length(filePaths) ) {\n  # To debug, change the '6' to some number to isolate the problem: for( i in 2:6 ) {\n  # message(\"About to read\", filePaths[i], \"\\\\\")\n  dsInfoSingle <- readRDS(filePaths[i])\n  dsInfo <- plyr::join(x=dsInfo, y=dsInfoSingle, by=\"Coefficient\", type=\"left\", match=\"all\")\n  rm(dsInfoSingle)\n}\n\n###################\n# Read in different REDS files \npathDataDirectory <- file.path(\"./Models/LCM/models/datasets\")\n# filenamePattern <- \".+\\\\.rds\" #All RDS files\nfilenamePattern <- \"m.{1,}FERE\\\\.rds\" #All RDS files\nretrievedFilenames <- list.files(path=pathDataDirectory, pattern=filenamePattern)\n\n# dsFERE <- readRDS(filePaths[1])\n\n# requireFieldsEvenIfNA <- c(\"sdRE\", \"timec\", \"intVarRE\", \"timecVarRE\", \"timec2VarRE\", \"timec3VarRE\")\n\nlst_ds <- NULL\nfor( i in seq_along(retrievedFilenames) ) {\n  filePath <- filePaths <- file.path(pathDataDirectory, retrievedFilenames[i])\n  dsFERESingle <- readRDS(filePath)\n  \n  dsFERESingle <- plyr::rename(dsFERESingle, replace=c(\"Value\"=\"Estimate\"), warn_missing=FALSE)\n  \n  #TODO: convert this into a loop\n  if( !(\"sdRE\" %in% colnames(dsFERESingle)) ) dsFERESingle$sdRE <- NA\n  if( !(\"timec\" %in% colnames(dsFERESingle)) ) dsFERESingle$timec <- NA\n  if( !(\"intVarRE\" %in% colnames(dsFERESingle)) ) dsFERESingle$intVarRE <- NA\n  if( !(\"timecVarRE\" %in% colnames(dsFERESingle)) ) dsFERESingle$timecVarRE <- NA\n  if( !(\"timec2VarRE\" %in% colnames(dsFERESingle)) ) dsFERESingle$timec2VarRE <- NA\n  if( !(\"timec3VarRE\" %in% colnames(dsFERESingle)) ) dsFERESingle$timec3VarRE <- NA\n  #   for( requiredField in requireFieldsEvenIfNA ) {\n  #     if( !(requireField %in% colnames(dsFERESingle)) )\n  #       dsFERESingle[[requireField]] <- NA\n  #   }\n  \n  lst_ds[[i]] <- dsFERESingle\n  \n  rm(dsFERESingle)\n}\n#names(lst_ds) <- gsub(pattern=\"(.+)\\\\.rds\", replacement=\"\\\\1\", x=retrievedFilenames)\nnames(lst_ds) <- gsub(pattern=\"(.+)\\\\_FERE.rds\", replacement=\"\\\\1\", x=retrievedFilenames)\n\nsaveRDS(lst_ds, file=\"./Models/LCM/models/datasets/ListOfModelOutcomes.rds\", compress=\"xz\")\n\n# lst_ds[\"m4R1_FERE\"]\n# modelNames\n\n",
    "created" : 1428007791904.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2510632716",
    "id" : "99649CAC",
    "lastKnownWriteTime" : 1407946659,
    "path" : "~/GitHub/Longitudinal_Models_of_Religiosity_NLSY97/Models/LCM/collecting results.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 0,
    "source_on_save" : false,
    "type" : "r_source"
}