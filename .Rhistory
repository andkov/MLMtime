<<<<<<< HEAD
ds <- dplyr::filter(dsL, id %in% sample(unique(id),100)) %>% # select only N ids
dplyr::select(id, dob, female, age80, edu11,wave, year, time, Age, irecall,animal,prospect, drecall)
head(ds)
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate mixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
pathDir  <- getwd() # get working directory, e.i. residence of .Rproj file
pathFile  <- file.path(pathDir,"Chapters/05/SAS_Chapter5/SAS_Chapter5.sas7bdat") # location of the file
ds0   <- read.sas7bdat(pathFile, debug=TRUE) # import file
# ds0 <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/ds0_ELSA.rds")
ds0 <- data.frame(ds0) # save as a data frame
## @knitr BasicDescriptive
class(ds0) # what class?
dim(ds0)  # what dimensions?
names(ds0) # what are column names?
str(ds0) # what its structure?
head(ds0) # what do first few lines look like?
base::summary(ds0) # basic summary
psych::describe(ds0) # summary by psych package
table(ds0$wave)# one-way table
## @knitr StackData
dsL <- ds0
=======
>>>>>>> origin/master
## @knitr TweakLong
dsM <- dsL
## @knitr dummyChunk
#### Basic Graphs  ####
## @knitr GraphingData0
p <- ggplot2::ggplot(dsM,aes(x=wave,y=outcome)) # map data dimension
p <- p + geom_line(aes(group=PersonID)) # draw lines and map unit of measurement
p
## @knitr LoadGraphThemes
baseSize <- 12 # set as the point of further reference
theme1 <- ggplot2::theme_bw(base_size=baseSize) +
ggplot2::theme(title=ggplot2::element_text(colour="gray20",size = baseSize+1)) +
ggplot2::theme(axis.text=ggplot2::element_text(colour="gray40", size=baseSize-2)) +
ggplot2::theme(axis.title=ggplot2::element_text(colour="gray40")) +
ggplot2::theme(panel.border = ggplot2::element_rect(colour="gray80")) +
ggplot2::theme(axis.ticks.length = grid::unit(0, "cm")) +
ggplot2::theme(text = element_text(size =baseSize+7))
## @knitr GraphingData1
p <- ggplot2::ggplot(dsM,aes(x=wave,y=outcome))
p <- p + geom_line(aes(group=PersonID)) # draw lines
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=5)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
p <- ggplot2::ggplot(dsM,aes(x=wave,y=outcome))
p <- p + geom_line(aes(group=PersonID))
p <- p + geom_point(size=6, shape=21, fill="purple", color="black", alpha=.5)
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=5)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
p <- ggplot2::ggplot(dsM,aes(x=wave, y=outcome))
p <- p + geom_line(aes(group=PersonID), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
p <- p + geom_line(aes(y=m3.1, group=PersonID), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr InspectM3_1
model  <- m3.1 # rename object for generic use
logLik <- summary(model)$logLik # extract log likelihood
deviance <- -2*logLik # extract deviance
AIC <- AIC(model) # extract Akaike information criterion
BIC <- BIC(model) # extract Bayesian information criterion
df.resid <- NA # empty slot for later use
N <- summary(model)$dims$N  # Number of distinct data points
p <- summary(model)$dims$p  # Number of estimated parameters
ids <- length(unique(dsM$PersonID)) # Number of unique units
df.resid <- N-p # residual degrees of freedom
mInfo <- data.frame("logLik" = logLik,   # collect model information indo a dataframe
"deviance"= deviance,
"AIC" = AIC, "BIC" = BIC,
"df.resid" = df.resid, "N" = N,
"p" = p, "ids" = ids)
t<- t(mInfo) # transpose
rownames(t)<-colnames(mInfo) # rename rows
mInfo<- data.frame(new=t) # turn into a dataframe
colnames(mInfo) <- c("m3.1") # rename columns
mi3.1 <- mInfo # save (m)odel (o)utput of model (3.1)
mi3.1$Coefficient <- rownames(mi3.1) # create a column with the name of each index
m3.1 #  model results
mi3.1 #  model information
head(dsM) # visual check
## @knitr GraphM3_1
p <- ggplot2::ggplot(dsM,aes(x=wave, y=outcome))
p <- p + geom_line(aes(group=PersonID), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
p <- p + geom_line(aes(y=m3.1, group=PersonID), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
m3.1 <- nlme::gls(outcome ~ 1, data=dsM, method="ML") # create model object
dsM$m3.1 <- predict(m3.1) # stores values predicted by the model
summary(m3.1) # print a bit more info
# str(summary(m3.1)) # to inspect object directly
## @knitr GraphM3_1
p <- ggplot2::ggplot(dsM,aes(x=wave, y=outcome))
p <- p + geom_line(aes(group=PersonID), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
p <- p + geom_line(aes(y=m3.1, group=PersonID), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
>>>>>>> origin/master
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate fixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
<<<<<<< HEAD
ds0 <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/ds0_ELSA.rds")
dim(ds0)
length(unique(ds0$PID))
head(ds0)
dsL <- ds0
## @knitr DataFilter
table(dsL$irecall,dsL$wave, useNA="ifany") # frequency table
# There are no valid respondes to the focal outcome, so we remove wave 5
# Wave 0 doesn't not contain observations of interest, so remove wave 0
dsL <- dplyr::filter(dsL, wave %in% c(1:4))
table(dsL$irecall,dsL$wave, useNA="ifany")
# The missing values will complecate some of the modeling so remove for now
## @knitr DataFilter2
# Selecting individuals into the working dataset
length(unique(dsL$id))
table(dsL$wave)
dsL <- dplyr::filter(dsL, (ave(!is.na(irecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(drecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(animal), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(prospect), id, FUN = all))) # only complete trajectoies
length(unique(dsL$id))
table(dsL$wave)
dsL <- dsL[dsL$id %in% unique((dsL[dsL$wave==4,c("id","wave")])$id ),] # only who reached 4th wave
length(unique(dsL$id))
table(dsL$wave)
## @knitr DataExport
# save data for use in R
saveRDS(object=dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds", compress="xz")
#### save LONG data for MPlus  ####
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.dat",col.names = F)
# save the header
varNamesL <- colnames(dsL) # get variable names
cat(varNamesL) # print, copy, paste into Mplus
write.csv(t(varNamesL), file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA_varNamesL.csv") # export as a csv
#### save WIDE data for MPlus ####
## Transform
head(dsL)
ds <- dplyr::select(dsL, id, dob, sex, age, edu, ht, db, htdb, nocase,
angina=ang1A, stroke=stk1A, smoked=evrsmk1A,
time, wave, year, ageCur=Age,
irecall, drecall, animal, prospect)
# head(ds)
timeInvariant <- c( "id", "dob", "sex", "age", "edu", "ht", "db", "htdb", "nocase",
"angina", "stroke", "smoked")
timeVariant <- c("time", "wave", "year", "ageCur", "irecall", "drecall", "animal","prospect")
dsLong <- reshape2::melt(ds,id.vars = c(timeInvariant, "wave"), measure.vars = timeVariant )
dsLong <- dsLong[order(dsLong$id, dsLong$variable), ]
# head(dsLong, 20)
dsW <- reshape2::dcast(dsLong, id + dob + sex + age + edu + ht + db + htdb + nocase + angina + stroke + smoked  ~ variable + wave, value.var="value"  )
head(dsW)
# Export the data
write.table(dsW,file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA.dat",col.names = F)
write.csv(colnames(dsW), file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA_varNames.csv")
# Export the header
varNamesW <- colnames(dsW) # get variable names
cat(varNamesW) # print, copy, paste into Mplus
write.csv(t(varNamesW), file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA_varNames.csv") # export as a csv
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate fixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
ds0 <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/ds0_ELSA.rds")
dim(ds0)
length(unique(ds0$PID))
head(ds0)
dsL <- ds0
## @knitr DataFilter
table(dsL$irecall,dsL$wave, useNA="ifany") # frequency table
# There are no valid respondes to the focal outcome, so we remove wave 5
# Wave 0 doesn't not contain observations of interest, so remove wave 0
dsL <- dplyr::filter(dsL, wave %in% c(1:4))
table(dsL$irecall,dsL$wave, useNA="ifany")
# The missing values will complecate some of the modeling so remove for now
## @knitr DataFilter2
# Selecting individuals into the working dataset
length(unique(dsL$id))
table(dsL$wave)
dsL <- dplyr::filter(dsL, (ave(!is.na(irecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(drecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(animal), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(prospect), id, FUN = all))) # only complete trajectoies
length(unique(dsL$id))
table(dsL$wave)
dsL <- dsL[dsL$id %in% unique((dsL[dsL$wave==4,c("id","wave")])$id ),] # only who reached 4th wave
length(unique(dsL$id))
table(dsL$wave)
## @knitr DataExport
# save data for use in R
saveRDS(object=dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds", compress="xz")
#### save LONG data for MPlus  ####
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.dat",col.names = F)
# save the header
varNamesL <- colnames(dsL) # get variable names
cat(varNamesL) # print, copy, paste into Mplus
write.csv(t(varNamesL), file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA_varNames.csv") # export as a csv
#### save WIDE data for MPlus ####
## Transform
head(dsL)
ds <- dplyr::select(dsL, id, dob, sex, age, edu, ht, db, htdb, nocase,
angina=ang1A, stroke=stk1A, smoked=evrsmk1A,
time, wave, year, ageCur=Age,
irecall, drecall, animal, prospect)
# head(ds)
timeInvariant <- c( "id", "dob", "sex", "age", "edu", "ht", "db", "htdb", "nocase",
"angina", "stroke", "smoked")
timeVariant <- c("time", "wave", "year", "ageCur", "irecall", "drecall", "animal","prospect")
dsLong <- reshape2::melt(ds,id.vars = c(timeInvariant, "wave"), measure.vars = timeVariant )
dsLong <- dsLong[order(dsLong$id, dsLong$variable), ]
# head(dsLong, 20)
dsW <- reshape2::dcast(dsLong, id + dob + sex + age + edu + ht + db + htdb + nocase + angina + stroke + smoked  ~ variable + wave, value.var="value"  )
head(dsW)
# Export the data
write.table(dsW,file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA.dat",col.names = F)
write.csv(colnames(dsW), file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA_varNames.csv")
# Export the header
varNamesW <- colnames(dsW) # get variable names
cat(varNamesW) # print, copy, paste into Mplus
write.csv(t(varNamesW), file="~/GitHub/psy564/Data/Derived/ELSA/dsW_ELSA_varNames.csv") # export as a csv
head(dsL)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.dat",col.names = F)
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate fixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
ds0 <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/ds0_ELSA.rds")
dim(ds0)
length(unique(ds0$PID))
head(ds0)
dsL <- ds0
## @knitr DataFilter
table(dsL$irecall,dsL$wave, useNA="ifany") # frequency table
# There are no valid respondes to the focal outcome, so we remove wave 5
# Wave 0 doesn't not contain observations of interest, so remove wave 0
dsL <- dplyr::filter(dsL, wave %in% c(1:4))
table(dsL$irecall,dsL$wave, useNA="ifany")
# The missing values will complecate some of the modeling so remove for now
## @knitr DataFilter2
# Selecting individuals into the working dataset
length(unique(dsL$id))
table(dsL$wave)
dsL <- dplyr::filter(dsL, (ave(!is.na(irecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(drecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(animal), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(prospect), id, FUN = all))) # only complete trajectoies
length(unique(dsL$id))
table(dsL$wave)
dsL <- dsL[dsL$id %in% unique((dsL[dsL$wave==4,c("id","wave")])$id ),] # only who reached 4th wave
length(unique(dsL$id))
table(dsL$wave)
## @knitr DataExport
# save data for use in R
saveRDS(object=dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds", compress="xz")
#### save LONG data for MPlus  ####
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.dat",col.names = F)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",col.names = F)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",skip=1)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",col.names=FALSE)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",col.names=FALSE)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",na=".",row.names=FALSE)
write.csv(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",na=".",row.names=FALSE, col.names=FALSE)
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",na=".",row.names=FALSE, col.names=FALSE)
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",na=".",row.names=FALSE, col.names=FALSE, sep=",")
write.table(dsL,file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.csv",na="-9999",row.names=FALSE, col.names=FALSE, sep=",")
=======
dsL <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/dsL_ELSA.rds")
dsL <- readRDS("~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds")
ds <- dplyr::filter(dsL, id %in% sample(unique(id),100)) %>% # select only N ids
dplyr::select(id, dob, female, hptn, dbts, condition, year, time, Age, irecall,animal,prospect, drecall)
head(ds)
## @knitr LoadGraphThemes
paletteColor4conditions <- c("Hypertension"="red",
"Diabetes"="blue",
"Both"="purple",
"None"="grey10")
baseSize <- 12 # set as the point of further reference
theme1 <- ggplot2::theme_bw(base_size=baseSize) +
ggplot2::theme(title=ggplot2::element_text(colour="gray20",size = baseSize+1)) +
ggplot2::theme(axis.text=ggplot2::element_text(colour="gray40", size=baseSize-2)) +
ggplot2::theme(axis.title=ggplot2::element_text(colour="gray40")) +
ggplot2::theme(panel.border = ggplot2::element_rect(colour="gray80")) +
ggplot2::theme(axis.ticks.length = grid::unit(0, "cm")) +
ggplot2::theme(text = element_text(size =baseSize+7))
## @knitr irecall_0R_1F_2x_x
p <- ggplot2::ggplot(ds,aes(x=wave, y=irecall))
p <- p + geom_line(aes(group=id), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
# p <- p + geom_line(aes(y=m3.1, group=id), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr EasyData
ds <- dplyr::filter(dsL, id %in% sample(unique(id),100)) %>% # select only N ids
dplyr::select(id, dob, female, age80, edu11, hptn, dbts, condition, wave, year, time, Age, irecall,animal,prospect, drecall)
head(ds)
p <- ggplot2::ggplot(ds,aes(x=wave, y=irecall))
p <- p + geom_line(aes(group=id), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
# p <- p + geom_line(aes(y=m3.1, group=id), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(5,25),
breaks=seq(5,25, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
p <- ggplot2::ggplot(ds,aes(x=wave, y=irecall))
p <- p + geom_line(aes(group=id), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.4) # cross-section data points
# p <- p + geom_line(aes(y=m3.1, group=id), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
ds$int <- 2
ds$linear <- .3
ds$quad <- .1
head(ds)
## @knitr CrossSectionCount
# Cross-sectional view: frequence of irecall
p <- ggplot2::ggplot(dsL, aes(x=factor(year)))
p <- p + scale_y_continuous(breaks=seq(0,6000,by=1000))
p <- p + geom_bar(aes(fill=condition), alpha=.4)
p <- p + facet_grid(dbts ~ hptn)
p <- p + scale_fill_manual(values=paletteColor4conditions)
p <- p + guides(fill = guide_legend(reverse=F, title="Diagnosis at A"))
p <- p + theme1
p
p <- ggplot2::ggplot(dsL, aes(y=irecall,x=factor(year), fill=condition))
p <- p + geom_violin( adjust=1, alpha=.4 )
p <- p + scale_y_continuous(limits=c(0,10), breaks=seq(0,10,by=1))
p <- p + scale_fill_manual(values=paletteColor4conditions)
p <- p + geom_boxplot(width=1, fill=NA, color="black", alpha=.5, outlier.colour="red")
p <- p + stat_summary(fun.y=mean, geom="point", fill="white", shape=21, size=4)
p <- p + facet_grid(dbts ~ hptn)
p <- p + theme1
p
>>>>>>> origin/master
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate fixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
ds0 <- readRDS("~/GitHub/psy564/Data/Raw/ELSA/ds0_ELSA.rds")
dim(ds0)
<<<<<<< HEAD
length(unique(ds0$PID))
head(ds0)
dsL <- ds0
## @knitr DataFilter
table(dsL$irecall,dsL$wave, useNA="ifany") # frequency table
# There are no valid respondes to the focal outcome, so we remove wave 5
# Wave 0 doesn't not contain observations of interest, so remove wave 0
dsL <- dplyr::filter(dsL, wave %in% c(1:4))
table(dsL$irecall,dsL$wave, useNA="ifany")
# The missing values will complecate some of the modeling so remove for now
## @knitr DataFilter2
# Selecting individuals into the working dataset
length(unique(dsL$id))
table(dsL$wave)
dsL <- dplyr::filter(dsL, (ave(!is.na(irecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(drecall), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(animal), id, FUN = all))) # only complete trajectoies
dsL <- dplyr::filter(dsL, (ave(!is.na(prospect), id, FUN = all))) # only complete trajectoies
length(unique(dsL$id))
table(dsL$wave)
dsL <- dsL[dsL$id %in% unique((dsL[dsL$wave==4,c("id","wave")])$id ),] # only who reached 4th wave
length(unique(dsL$id))
table(dsL$wave)
## @knitr DataExport
# save data for use in R
saveRDS(object=dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds", compress="xz")
#### save LONG data for MPlus  ####
write.table(dsL,file="~/GitHub/psy564/Projects/ELSA/CogDecline/dsL_ELSA.csv",na="-9999",row.names=FALSE, col.names=FALSE, sep=",")
# save the header
varNamesL <- colnames(dsL) # get variable names
cat(varNamesL) # print, copy, paste into Mplus
write.csv(t(varNamesL), file="~/GitHub/psy564/Projects/ELSA/CogDecline/dsL_ELSA_varNames.csv") # export as a csv
readRDS(dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds", compress="xz")
readRDS(dsL, file="~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds")
=======
View(ds0)
<<<<<<< HEAD
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate mixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
pathDir  <- getwd() # get working directory, e.i. residence of .Rproj file
pathFile  <- file.path(pathDir,"Chapters/05/SAS_Chapter5/SAS_Chapter5.sas7bdat") # location of the file
# ds0   <- read.sas7bdat(pathFile, debug=TRUE) # import file
ds0 <- readRDS("~/GitHub/psy564/Data/Derived/ELSA/dsM_ELSA.rds")
ds0 <- data.frame(ds0) # save as a data frame
## @knitr BasicDescriptive
class(ds0) # what class?
dim(ds0)  # what dimensions?
names(ds0) # what are column names?
str(ds0) # what its structure?
head(ds0) # what do first few lines look like?
base::summary(ds0) # basic summary
psych::describe(ds0) # summary by psych package
table(ds0$wave)# one-way table
## @knitr StackData
dsL <- ds0
## @knitr TweakLong
dsM <- dsL
dsM <- dplyr::filter(dsM, id %in% sample(unique(id),100))
## @knitr dummyChunk
#### Basic Graphs  ####
## @knitr GraphingData0
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall)) # map data dimension
p <- p + geom_line(aes(group=id)) # draw lines and map unit of measurement
p
## @knitr LoadGraphThemes
baseSize <- 12 # set as the point of further reference
theme1 <- ggplot2::theme_bw(base_size=baseSize) +
ggplot2::theme(title=ggplot2::element_text(colour="gray20",size = baseSize+1)) +
ggplot2::theme(axis.text=ggplot2::element_text(colour="gray40", size=baseSize-2)) +
ggplot2::theme(axis.title=ggplot2::element_text(colour="gray40")) +
ggplot2::theme(panel.border = ggplot2::element_rect(colour="gray80")) +
ggplot2::theme(axis.ticks.length = grid::unit(0, "cm")) +
ggplot2::theme(text = element_text(size =baseSize+7))
## @knitr GraphingData1
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall))
p <- p + geom_line(aes(group=id)) # draw lines
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr GraphingData2
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall))
p <- p + geom_line(aes(group=id))
p <- p + geom_point(size=6, shape=21, fill="purple", color="black", alpha=.5)
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr dummyChunk
####  MODEL 3.1  ####
## @knitr RunM3_1
m3.1 <- nlme::gls(irecall ~ 1, data=dsM, method="ML") # create model object
dsM$m3.1 <- predict(m3.1) # stores values predicted by the model
summary(m3.1) # print a bit more info
# str(summary(m3.1)) # to inspect object directly
## @knitr InspectM3_1
model  <- m3.1 # rename object for generic use
logLik <- summary(model)$logLik # extract log likelihood
deviance <- -2*logLik # extract deviance
AIC <- AIC(model) # extract Akaike information criterion
BIC <- BIC(model) # extract Bayesian information criterion
df.resid <- NA # empty slot for later use
N <- summary(model)$dims$N  # Number of distinct data points
p <- summary(model)$dims$p  # Number of estimated parameters
ids <- length(unique(dsM$id)) # Number of unique units
df.resid <- N-p # residual degrees of freedom
mInfo <- data.frame("logLik" = logLik,   # collect model information indo a dataframe
"deviance"= deviance,
"AIC" = AIC, "BIC" = BIC,
"df.resid" = df.resid, "N" = N,
"p" = p, "ids" = ids)
t<- t(mInfo) # transpose
rownames(t)<-colnames(mInfo) # rename rows
mInfo<- data.frame(new=t) # turn into a dataframe
colnames(mInfo) <- c("m3.1") # rename columns
mi3.1 <- mInfo # save (m)odel (o)utput of model (3.1)
mi3.1$Coefficient <- rownames(mi3.1) # create a column with the name of each index
m3.1 #  model results
mi3.1 #  model information
head(dsM) # visual check
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate mixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
pathDir  <- getwd() # get working directory, e.i. residence of .Rproj file
pathFile  <- file.path(pathDir,"Chapters/05/SAS_Chapter5/SAS_Chapter5.sas7bdat") # location of the file
# ds0   <- read.sas7bdat(pathFile, debug=TRUE) # import file
ds0 <- readRDS("~/GitHub/psy564/Data/Derived/ELSA/dsM_ELSA.rds")
ds0 <- data.frame(ds0) # save as a data frame
# remove all elements for a clean start
rm(list=ls(all=TRUE))
cat("\014")
## @knitr InstallPackage
# source("./Scripts/Utility/InstallPackages.R")
## @knitr LoadPackages
require(sas7bdat) # for inputting data
library(dplyr) # for general data manipulation
library(reshape2) # for data : wide <-> long
library(psych) # data summary + etc
library(ggplot2) # graphing
library(nlme) # estimate mixed models | esp. gls()
library(lme4) # estimate mixed models | esp. lmer()
library(arm)  # process model objects
## @knitr LoadData
pathDir  <- getwd() # get working directory, e.i. residence of .Rproj file
pathFile  <- file.path(pathDir,"Chapters/05/SAS_Chapter5/SAS_Chapter5.sas7bdat") # location of the file
# ds0   <- read.sas7bdat(pathFile, debug=TRUE) # import file
ds0 <- readRDS("~/GitHub/psy564/Data/Derived/ELSA/dsL_ELSA.rds")
ds0 <- data.frame(ds0) # save as a data frame
## @knitr BasicDescriptive
class(ds0) # what class?
dim(ds0)  # what dimensions?
names(ds0) # what are column names?
str(ds0) # what its structure?
head(ds0) # what do first few lines look like?
base::summary(ds0) # basic summary
psych::describe(ds0) # summary by psych package
table(ds0$wave)# one-way table
## @knitr StackData
dsL <- ds0
## @knitr TweakLong
dsM <- dsL
dsM <- dplyr::filter(dsM, id %in% sample(unique(id),100))
## @knitr dummyChunk
#### Basic Graphs  ####
## @knitr GraphingData0
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall)) # map data dimension
p <- p + geom_line(aes(group=id)) # draw lines and map unit of measurement
p
## @knitr LoadGraphThemes
baseSize <- 12 # set as the point of further reference
theme1 <- ggplot2::theme_bw(base_size=baseSize) +
ggplot2::theme(title=ggplot2::element_text(colour="gray20",size = baseSize+1)) +
ggplot2::theme(axis.text=ggplot2::element_text(colour="gray40", size=baseSize-2)) +
ggplot2::theme(axis.title=ggplot2::element_text(colour="gray40")) +
ggplot2::theme(panel.border = ggplot2::element_rect(colour="gray80")) +
ggplot2::theme(axis.ticks.length = grid::unit(0, "cm")) +
ggplot2::theme(text = element_text(size =baseSize+7))
## @knitr GraphingData1
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall))
p <- p + geom_line(aes(group=id)) # draw lines
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr GraphingData2
p <- ggplot2::ggplot(dsM,aes(x=wave,y=irecall))
p <- p + geom_line(aes(group=id))
p <- p + geom_point(size=6, shape=21, fill="purple", color="black", alpha=.5)
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr RunM3_1
m3.1 <- nlme::gls(irecall ~ 1, data=dsM, method="ML") # create model object
dsM$m3.1 <- predict(m3.1) # stores values predicted by the model
summary(m3.1) # print a bit more info
# str(summary(m3.1)) # to inspect object directly
## @knitr InspectM3_1
model  <- m3.1 # rename object for generic use
logLik <- summary(model)$logLik # extract log likelihood
deviance <- -2*logLik # extract deviance
AIC <- AIC(model) # extract Akaike information criterion
BIC <- BIC(model) # extract Bayesian information criterion
df.resid <- NA # empty slot for later use
N <- summary(model)$dims$N  # Number of distinct data points
p <- summary(model)$dims$p  # Number of estimated parameters
ids <- length(unique(dsM$id)) # Number of unique units
df.resid <- N-p # residual degrees of freedom
mInfo <- data.frame("logLik" = logLik,   # collect model information indo a dataframe
"deviance"= deviance,
"AIC" = AIC, "BIC" = BIC,
"df.resid" = df.resid, "N" = N,
"p" = p, "ids" = ids)
t<- t(mInfo) # transpose
rownames(t)<-colnames(mInfo) # rename rows
mInfo<- data.frame(new=t) # turn into a dataframe
colnames(mInfo) <- c("m3.1") # rename columns
mi3.1 <- mInfo # save (m)odel (o)utput of model (3.1)
mi3.1$Coefficient <- rownames(mi3.1) # create a column with the name of each index
m3.1 #  model results
mi3.1 #  model information
head(dsM) # visual check
## @knitr GraphM3_1
p <- ggplot2::ggplot(dsM,aes(x=wave, y=irecall))
p <- p + geom_line(aes(group=id), color="firebrick", alpha=.5)  # individual trajectories
p <- p + geom_point(size=3, shape=21, fill=NA, color="black", alpha=.6) # cross-section data points
p <- p + geom_line(aes(y=m3.1, group=id), color="royalblue3", size=3, alpha=.05) # modelled data
p <- p + theme1
p <- p + scale_x_continuous(limits=c(1,4), breaks=c(1:4)) # X axis
p <- p + scale_y_continuous(limits=c(0,10),
breaks=seq(0,10, by=1)) # Y axis
p <- p + labs(list(
title="Does outcome change over time?", # main title
x="Wave of measurement", y="Performance on the outcome")) # axes titles
p
## @knitr RunM5_1
m5.1 <- lme4::lmer(irecall ~ 1 + (1 | id), data=dsM, REML=FALSE)# create model object
dsM$m5.1 <- predict(m5.1) # stores values predicted by the model
display(m5.1) # tidy results
## @knitr InspectM5_1
model <- m5.1
mInfo<-summary(model)$AICtab
mInfo["N"]<- model@devcomp$dims["N"] # number of datapoints, verify
mInfo["p"]<- model@devcomp$dims["p"] # number of estimated parameters, verify
mInfo["ids"]<- (summary(model))$ngrps # number of units on level-2, here: individuals
# mInfo<- c(mInfo, "modelName"=modelName)
mInfo<-data.frame(mInfo) # turn into a dataframe
mInfo<- plyr::rename(mInfo,replace= c("mInfo"="m5.1")) # rename variables
mInfo$Coefficient <- rownames(mInfo) # save index names as a column
mi5.1 <- mInfo # create model information  object
display(m5.1)
mi5.1 #  model information
head(dsM) # visual check
=======
>>>>>>> origin/master
source(./Scripts/Mplus/mplus.R)
source("./Scripts/Mplus/mplus.R")
irecall_0r_1r_x <- "./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5"
mplus.view.plot(irecall_0r_1r_x)
source("./Scripts/Mplus/mplus.R")
irecall_0r_1r_x <- "./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5"
mplus.view.plot(irecall_0r_1r_x)
library(mplus)
source("./Scripts/Mplus/mplus.R")
ls()
mplus.view.plots(irecall_0r_1r_x)
a <- mplus.list.variables('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5')
b <- mplus.get.data('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5',variable)
mplus.list.variables('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5')
mplus.plot.histogram(irecall_0r_1r_x, "OUTCOME")
mplus.plot.histogram(irecall_0r_1r_x, "TIMEL")
mplus.plot.histogram(irecall_0r_1r_x, "LINEAR")
mplus.plot.histogram(irecall_0r_1r_x, "B_OUTCOME")
b <- mplus.get.data('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5', "OUTCOME")
b <- mplus.get.data('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5', c("OUTCOME", "TIMEL") )
b <- mplus.get.data('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5', c("OUTCOME", "TIMEL") )
b <- mplus.get.data('./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_NoCovar.gh5',  "TIMEL" )
m1 <- "./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_01age80_01edu11.gh5"
mplus.list.variables(m1)
mplus.list.variables(m1)
m1 <- "./Projects/ELSA/CogDecline/irecall/irecall_0r_1r_01age80_01edu11.gh5"
mplus.list.variables(m1)
a <- mplus.get.data(m1,"ID")
b <- mplus.get.data(m1,"TIMEL")
c <- mplus.get.data(m1,"OUTCOME")
d <- mplus.get.data(m1,"B_OUTCOME")
e <- mplus.get.data(m1,"LINEAR")
f <- mplus.get.data(m1,"EDU11")
g <- mplus.get.data(m1,"AGE80")
ds <- cbind(a, b, c, d, e, f, g)
ds <- data.frame(cbind(a, b, c, d, e, f, g))
head(ds)
mplus.list.variables(m1)
a <- mplus.get.data(m1,"ID")
b <- mplus.get.data(m1,"TIMEL")
c <- mplus.get.data(m1,"OUTCOME")
f <- mplus.get.data(m1,"EDU11")
g <- mplus.get.data(m1,"AGE80")
d <- mplus.get.data(m1,"B_OUTCOME")
e <- mplus.get.data(m1,"LINEAR")
ds <- data.frame(cbind(a, b, c, d, e, f, g))
head(ds)
mplus.list.variables(m1)
all <- cbind(a, b, c, d, e, f, g)
names(all) <-  c("OUTCOME", "TIMEL","EDU11","AGE80","LINEAR","B_OUTCOME","ID")
ds <- data.frame(all)
head(ds)
ds <- data.frame(cbind(a, b, c, d, e, f, g))
names(ds) <-  c("OUTCOME", "TIMEL","EDU11","AGE80","LINEAR","B_OUTCOME","ID")
head(ds)
a <- mplus.get.data(m1,"OUTCOME")
b <- mplus.get.data(m1,"TIMEL")
c <- mplus.get.data(m1,"EDU11")
d <- mplus.get.data(m1,"AGE80")
e <- mplus.get.data(m1,"LINEAR")
f <- mplus.get.data(m1,"B_OUTCOME")
g <- mplus.get.data(m1,"ID")
ds <- data.frame(cbind(a, b, c, d, e, f, g))
names(ds) <-  c("OUTCOME", "TIMEL","EDU11","AGE80","LINEAR","B_OUTCOME","ID")
head(ds)
>>>>>>> origin/master
